\documentclass[a4paper,12pt]{article}
\usepackage{xcolor}
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage{titlesec}
\usepackage{tikz}
\usepackage{booktabs}
\usepackage{array}
\usetikzlibrary{shadows}
\usepackage{tcolorbox}
\usepackage{float}
\usepackage{lipsum}
\usepackage{mdframed}
\usepackage{pagecolor}
\usepackage{mathpazo}   % Palatino font (serif)
\usepackage{microtype}  % Better typography

\usepackage{listings}
\usepackage{xcolor}

% Configuration for the C language
\lstset{
    language=C,                     % Set language to C
    frame=single,                   % Draw a box around the code
    basicstyle=\ttfamily,           % Set the basic font to typewriter
    keywordstyle=\bfseries\color{blue}, % Color for keywords
    commentstyle=\itshape\color{green!60!black},  % Color for comments
    stringstyle=\color{red},        % Color for strings
    numbers=left,                   % Line numbers on the left
    numberstyle=\tiny\color{gray},  % Style of line numbers
    stepnumber=1,                   % Line number increment
    tabsize=4,                      % Set tab width
    showspaces=false,               % Don't show spaces
    showstringspaces=false,         % Don't show string spaces
    breaklines=true,                % Automatic line breaking
    captionpos=b,                   % Caption at the bottom
    escapeinside={\%*}{*)},         % For escaping to LaTeX inside the code
    morekeywords={uint32_t, uint8_t} % Add more keywords if needed
}

% Page background color
\pagecolor{gray!10!white}

% Geometry settings
\geometry{margin=0.5in}
\pagestyle{fancy}
\fancyhf{}

% Fancy header and footer
\fancyhead[C]{\textbf{\color{blue!80}CS348 Assignment-3}}
\fancyhead[R]{\color{blue!80}Saksham Rathi}
\fancyfoot[C]{\thepage}

% Custom Section Color and Format with Sans-serif font
\titleformat{\section}
{\sffamily\color{purple!90!black}\normalfont\Large\bfseries}
{\thesection}{1em}{}

% Custom subsection format
\titleformat{\subsection}
{\sffamily\color{cyan!80!black}\normalfont\large\bfseries}
{\thesubsection}{1em}{}

% Stylish Title with TikZ (Enhanced with gradient)
\newcommand{\cooltitle}[1]{%
  \begin{tikzpicture}
    \node[fill=blue!20,rounded corners=10pt,inner sep=12pt, drop shadow, top color=blue!50, bottom color=blue!30] (box)
    {\Huge \bfseries \color{black} #1};
  \end{tikzpicture}
}
\usepackage{float} % Add this package

\newenvironment{solution}[2][]{%
    \begin{mdframed}[linecolor=blue!70!black, linewidth=2pt, roundcorner=10pt, backgroundcolor=yellow!10!white, skipabove=12pt, skipbelow=12pt]%
        \textbf{\large #2}
        \par\noindent\rule{\textwidth}{0.4pt}
}{
    \end{mdframed}
}

% Document title
\title{\cooltitle{CS378 Lab-6 Report}}
\author{
    {\bf Saksham Rathi (22B1003)} \\ 
    Department of Computer Science, IIT Bombay \\
}
\date{}

\begin{document}
\maketitle

\begin{solution}{Part 1: Investigating HTTP Traffic with Wireshark}

\textbf{Part (a)} Both client and server are running version 1.1 of HTTP.

\textbf{Part (b)} The IP Address of the client machine is 192.168.1.102 and the IP Address of the server machine is 128.119.245.12

\textbf{Part (c)} The status code returned by the server to the client browser is 200 (OK).

\textbf{Part (d)} The HTML file which the client is retrieving last modified at the server is ``/ethereal-labs/lab2-1.html''. The last modified time is ``Tue, 23 Sep 2003 05:29:00 GMT''. (From follow $\rightarrow$ HTTP)

\textbf{Part (e)} The number of bytes in the server's response is 439 bytes.
\end{solution}

\begin{solution}{Part 2: Basic Authentication over HTTP}

    \textbf{Part (a)} The response of the server to the first get request is ``Authorization Required''. The status code is 401. The server's response of "Authorization Required" with a status code of 401 indicates that the client (your application or browser) is trying to access a resource that requires authentication, but no valid credentials were provided.

    \textbf{Part (b)} This request contains the authorisation field too: 
    
    ``Authorization: Basic ZXRoLXN0dWRlbnRzOm5ldHdvcmtz''. 
    
    $<credentials>$ (the content after Basic) is the Base64 encoding of ID and password joined by a single colon :.

    \textbf{Part (c)} The username is ``eth-students'' and the password is ``network''. The username and password are separated by a colon and then encoded in Base64. (Decoded using a python script)
\end{solution}

\begin{solution}{Part 3: Analysing and Decrypting TLS Traffic}
    Public-key cryptography provides a method for secure communication between two parties over the Internet, even if they have never interacted before. It works on the principle of using a pair of keys: a public key, which can be shared openly, and a private key, which is kept secret by its owner. When one party wants to send a secure message to the other, they encrypt the message using the recipient's public key. Since the public key is publicly available, anyone can use it to encrypt messages, but only the recipient can decrypt them with their private key.

    \textbf{Part (a)} The cipher common between both SSL End points is ``ECDHE-RSA-AES256-GCM-SHA384''

    \textbf{Part (b)} The protocol which was used for communication is ``TLSv1.2''.

    \textbf{Part (c)} The master key is 
    
    {\small ``9F9A0F19A02BDDBE1A05926597D622CCA06D2AF416A28AD9C03163B87\\FF1B0C67824BBDB595B32D8027DB566EC04FB25''.}
\end{solution}

\begin{solution}{Part 4: Capturing Your Own Traffic}

    The last modified time of the website is: ``Wed, 29 Jun 2022 00:23:22 GMT''. Here is the screenshot displaying the same:
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{lab6p21.png}
        \caption{Last Modified Time of the Website}
    \end{figure}

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.5\textwidth]{lab6p22.png}
        \caption{The packet which was followed}
    \end{figure}

    Then I used Wireshark for loopback interface too. Here is the screenshot of data which was sent from sender.c:

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{Screenshot 2024-10-17 at 3.28.23â€¯PM.png}
        \caption{Data sent from sender.c}
    \end{figure}
    The characters `a' represent the first packet and characters `b' represent the second packet of the pair. The first numbers represent the packet size (the first packet). Then the numbers in between are the packet numbers. All of this was visible from the follow UDP Stream on Wireshark.
\end{solution}


\begin{solution}{Part 5: Using Scapy for Packet Manipulation}
    In the first part, I have sent a simple ICMP packet containing the message "Hello Saksham" to my loopback IP Address. The packet was sent successfully and the response was received too. Here is the screenshot of the same:

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.6\textwidth]{p51.png}
        \caption{Sending ICMP Packet using Scapy}
    \end{figure}

    The lower right corner also shows the message which was sent.

    In the second part, we need to request a non-standard DNS record type and send to a DNS Server. This python script expects the server IP Address (I did to google.com whose IP Address is 8.8.8.8) and the domain name. Here is the output from the script:
    
    \begin{verbatim}                   
        Enter the DNS server IP address (e.g., 8.8.8.8): 8.8.8.8
        Enter the domain name to query (e.g., example.com): google.com
        Begin emission
        ...
        Finished sending 1 packets
        *
        Received 4 packets, got 1 answers, remaining 0 packets
        Received DNS response from 8.8.8.8:
        IP / UDP / DNS Ans b'ns3.google.com.'
        ###[ IP ]###
          version   = 4
          ihl       = 5
          tos       = 0x0
          len       = 128
          id        = 41225
          flags     = DF
          frag      = 0
          ttl       = 61
          proto     = udp
          chksum    = 0x7e62
          src       = 8.8.8.8
          dst       = 10.59.3.183
          \options   \
        ###[ UDP ]###
             sport     = domain
             dport     = domain
             len       = 108
             chksum    = 0x5878
        ###[ DNS ]###
                id        = 0
                qr        = 1
                opcode    = QUERY
                aa        = 0
                tc        = 0
                rd        = 1
                ra        = 1
                z         = 0
                ad        = 0
                cd        = 0
                rcode     = ok
                qdcount   = 1
                ancount   = 4
                nscount   = 0
                arcount   = 0
                \qd        \
                 |###[ DNS Question Record ]###
                 |  qname     = b'google.com.'
                 |  qtype     = ALL
                 |  unicastresponse= 0
                 |  qclass    = IN
                \an        \
                 |###[ DNS Resource Record ]###
                 |  rrname    = b'google.com.'
                 |  type      = NS
                 |  cacheflush= 0
                 |  rclass    = IN
                 |  ttl       = 345589
                 |  rdlen     = None
                 |  rdata     = b'ns3.google.com.'
                 |###[ DNS Resource Record ]###
                 |  rrname    = b'google.com.'
                 |  type      = NS
                 |  cacheflush= 0
                 |  rclass    = IN
                 |  ttl       = 345589
                 |  rdlen     = None
                 |  rdata     = b'ns2.google.com.'
                 |###[ DNS Resource Record ]###
                 |  rrname    = b'google.com.'
                 |  type      = NS
                 |  cacheflush= 0
                 |  rclass    = IN
                 |  ttl       = 345589
                 |  rdlen     = None
                 |  rdata     = b'ns1.google.com.'
                 |###[ DNS Resource Record ]###
                 |  rrname    = b'google.com.'
                 |  type      = NS
                 |  cacheflush= 0
                 |  rclass    = IN
                 |  ttl       = 345589
                 |  rdlen     = None
                 |  rdata     = b'ns4.google.com.'
                \ns        \
                \ar        \
    \end{verbatim}

    Here is the screenshot from Wireshark:

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{p52.png}
        \caption{Wireshark Output for DNS Query}
    \end{figure}

    The selected packets are the ones which were sent.

    
    In the third part, we were supposed to create a TCP SYN packet with a spoofed source IP Address.

    Here is the screenshot of the same:

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{p53.png}
        \caption{Sending TCP SYN Packet with Spoofed Source IP Address}
    \end{figure}

    I spoofed my IP to 9.9.9.9 (line number 616 in the image shown). 
\end{solution}

\end{document}
